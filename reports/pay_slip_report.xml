<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <report
        id="action_report_payslip"
        model="wdw.pay.slip"
        string="Phiếu lương"
        report_type="qweb-pdf"
        name="wdw_salary_management.report_payslip_template"
        file="wdw_salary_management.report_payslip_template"
        print_report_name="'Payslip - %s' % (object.employee_id.name)"
    />
    
    <template id="report_payslip_template">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="doc">
                <div class="page" style="font-family: Arial;">
                    <div class="text-center">
                        <h2>PHIẾU LƯƠNG THÁNG <t t-esc="doc.period_id.name"/></h2>
                        <p style="font-size: 12px;">Ngày in: <t t-esc="context_timestamp(datetime.datetime.now()).strftime('%d/%m/%Y')"/></p>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <strong>THÔNG TIN NHÂN VIÊN</strong>
                        <table class="table table-bordered" style="width: 100%; font-size: 12px;">
                            <tr>
                                <td style="width: 20%;"><strong>Mã NV:</strong></td>
                                <td><t t-esc="doc.employee_code"/></td>
                                <td style="width: 20%;"><strong>Họ tên:</strong></td>
                                <td><t t-esc="doc.employee_id.name"/></td>
                            </tr>
                            <tr>
                                <td><strong>Bộ phận:</strong></td>
                                <td><t t-esc="doc.department_id.name or ''"/></td>
                                <td><strong>Chức vụ:</strong></td>
                                <td><t t-esc="doc.job_id.name or ''"/></td>
                            </tr>
                            <tr>
                                <td><strong>Ngày vào:</strong></td>
                                <td><t t-esc="doc.join_date and doc.join_date.strftime('%d/%m/%Y') or ''"/></td>
                                <td><strong>Tài khoản:</strong></td>
                                <td><t t-esc="doc.bank_account or ''"/></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <strong>THỜI GIAN LÀM VIỆC</strong>
                        <table class="table table-bordered" style="width: 100%; font-size: 12px;">
                            <tr>
                                <td>Đi làm: <t t-esc="doc.working_days"/></td>
                                <td>Nghỉ phép: <t t-esc="doc.leave_days"/></td>
                                <td>KL-KLD: <t t-esc="doc.unpaid_leave_days"/></td>
                            </tr>
                            <tr>
                                <td>ĐMVS: <t t-esc="doc.late_early_hours"/></td>
                                <td>Tồn phép: <t t-esc="doc.leave_balance"/></td>
                                <td></td>
                            </tr>
                        </table>
                    </div>
                    
                    <div style="margin: 20px 0;">
                        <table style="width: 100%; font-size: 12px;">
                            <tr>
                                <td style="width: 49%; vertical-align: top;">
                                    <strong>THU NHẬP</strong>
                                    <table class="table table-bordered" style="width: 100%;">
                                        <tr><td>Lương ngày công</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.workday_pay)"/></td></tr>
                                        <tr><td>Phụ cấp thâm niên</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.seniority_allowance)"/></td></tr>
                                        <tr><td>PC đi lại</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.transport_allowance)"/></td></tr>
                                        <tr><td>PC nhà ở</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.house_allowance)"/></td></tr>
                                        <tr><td>PC môi trường</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.environment_allowance)"/></td></tr>
                                        <tr><td>PC vị trí</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.position_allowance)"/></td></tr>
                                        <tr><td>PC công việc</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.work_allowance)"/></td></tr>
                                        <tr><td>PC kỹ năng</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.skill_allowance)"/></td></tr>
                                        <tr><td>PC chuyên cần</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.attendance_allowance)"/></td></tr>
                                        <tr><td>PC hàn, Xray</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.soldering_xray_allowance)"/></td></tr>
                                        <tr><td>OT 150%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.ot_150_amount)"/></td></tr>
                                        <tr><td>OT 210%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.ot_210_amount)"/></td></tr>
                                        <tr><td>OT đêm 200%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.ot_night_200_amount)"/></td></tr>
                                        <tr><td>OT đêm 150%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.ot_night_150_amount)"/></td></tr>
                                        <tr><td>Chủ nhật 200%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.sunday_200_amount)"/></td></tr>
                                        <tr><td>Chủ nhật 270%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.sunday_270_amount)"/></td></tr>
                                        <tr><td>Lễ 300%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.holiday_300_amount)"/></td></tr>
                                        <tr><td>Lễ 390%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.holiday_390_amount)"/></td></tr>
                                        <tr><td>Sinh nhật</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.birthday_amount)"/></td></tr>
                                        <tr><td>Công tác phí</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.business_trip_amount)"/></td></tr>
                                        <tr><td>Bù lương</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.compensation_amount)"/></td></tr>
                                        <tr><td>Thưởng đánh giá</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.evaluation_bonus)"/></td></tr>
                                        <tr><td>Trợ cấp con nhỏ</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.child_support)"/></td></tr>
                                        <tr><td>Phụ nữ</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.women_amount)"/></td></tr>
                                        <tr style="font-weight: bold; border-top: 2px solid;"><td>TỔNG THU NHẬP</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.gross_salary)"/></td></tr>
                                    </table>
                                </td>
                                <td style="width: 2%;"></td>
                                <td style="width: 49%; vertical-align: top;">
                                    <strong>CÁC KHOẢN TRỪ</strong>
                                    <table class="table table-bordered" style="width: 100%;">
                                        <tr><td>Vi phạm</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.violation_deduction)"/></td></tr>
                                        <tr><td>Trừ đồng phục</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.uniform_card_deduction)"/></td></tr>
                                        <tr><td>Truy thu phép âm</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.negative_leave_deduction)"/></td></tr>
                                        <tr><td>Đi muộn về sớm</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.late_early_deduction)"/></td></tr>
                                        <tr><td>BHXH 8%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.social_insurance)"/></td></tr>
                                        <tr><td>BHYT 1.5%</td><td class="text-right"><t t-esc="'{:,.0f}'.format(doc.health_insurance)"/></